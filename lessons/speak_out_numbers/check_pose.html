<html>
    <head>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet"></script>
        <style>
        </style>
    </head>
    <body>
        <div id='photo'>
            <canvas id="canvas"></canvas>
            <img id='sample' src='./images/sample.jpg '/>
            <p id='keypoints'></p>
        </div>
        <div id='keypoints'>
        </div>
    </body>
    <script>
        function startup() {
            var imageElement = document.getElementById('sample');
            posenet.load().then(function(net){
                return net.estimateMultiplePoses(imageElement, {
                flipHorizontal: false,
                maxDetections: 1,
                scoreThreshold: 0.6,
                nmsRadius: 20})
            }).then(function(poses){
                /*console.log(poses);
                console.log("Array Length: ",poses.length);*/
                var text='';
                var part = "";
                var partx = "";
                var party = "";
                for (i=0; i<poses.length; i++) {
                    console.log("Keypoints: ", poses[i].keypoints);
                    console.log("Keypoints Length: ", poses[i].keypoints.length);
                    for (j=0; j<poses[i].keypoints.length; j++) {
                        part = poses[i].keypoints[j].part;
                        partx = poses[i].keypoints[j].position.x;
                        party = poses[i].keypoints[j].position.y;
                        text += part + " ";
                        text += partx + " ";
                        text += party + "\n";
                        drawPoints(partx, party);
                    }
                }
                document.getElementById('keypoints').innerText= `${text}`;
            })
        }
        function drawPoints(x,y) {
            var img=document.getElementById("sample"); 
            var c=document.getElementById("canvas");
            c.width = img.naturalWidth;
            c.height = img.naturalHeight;
            console.log("Draw: ", x, y, c.width, c.height);
            var ctx=c.getContext("2d");
            ctx.drawImage(img,0,0);  
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            context.beginPath();
            ctx.arc(x, y, 10, 0, 360, true);
            ctx.strokeStyle = 'red';
            ctx.stroke();
            var data = canvas.toDataURL('image/png');
           img.setAttribute('src', data);
        }
        function drawSquare(x,y,w,h) {
            var c=document.getElementById("canvas");
            var ctx=c.getContext("2d");
            var img=document.getElementById("photo");  
            ctx.drawImage(img,0,0);  
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            context.beginPath();
            context.rect(x, y, w, h);
            context.lineWidth = 1;
            context.strokeStyle = 'red';
            context.stroke();
            data = canvas.toDataURL('image/png');
            photo.setAttribute('src', data);
        }
        window.addEventListener('load', startup, false);
    </script>
</html>
