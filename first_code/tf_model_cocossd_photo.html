<html>
    <head><title>Local video playback</title></head>
    <body>
        <video id="localVideo" autoplay playsinline controls="false"></video>
        <script>
            /*const openMediaDevices = async (constraints) => {
                return await navigator.mediaDevices.getUserMedia(constraints);
            }
            try {
                const stream = openMediaDevices({'video':true,'audio':true});
                console.log('Got MediaStream:', stream);
            } catch(error) {
                console.error('Error accessing media devices.', error);
            }*/
            async function getConnectedDevices(type) {
                const devices = await navigator.mediaDevices.enumerateDevices();
                return devices.filter(device => device.kind === type)
            }

            //const videoCameras = getConnectedDevices('videoinput');
            //console.log('Cameras found:', videoCameras);
            
            // Updates the select element with the provided set of cameras
            function updateCameraList(cameras) {
                const listElement = document.querySelector('select#availableCameras');
                listElement.innerHTML = '';
                cameras.map(camera => {
                    const cameraOption = document.createElement('option');
                    cameraOption.label = camera.label;
                    cameraOption.value = camera.deviceId;
                }).forEach(cameraOption => listElement.add(cameraOption));
            }

            // Fetch an array of devices of a certain type
            async function getConnectedDevices(type) {
                const devices = await navigator.mediaDevices.enumerateDevices();
                return devices.filter(device => device.kind === type)
            }

            // Get the initial set of cameras connected
            const videoCameras = getConnectedDevices('videoinput');
            updateCameraList(videoCameras);
            console.log('Cameras found:', videoCameras);

            // Listen for changes to media devices and update the list accordingly
            navigator.mediaDevices.addEventListener('devicechange', event => {
                const newCameraList = getConnectedDevices('video');
                updateCameraList(newCameraList);
            });
        </script>
    </body>
</html>
